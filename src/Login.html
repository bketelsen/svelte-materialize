<div class="container">
	<div class="section">
		<h1>
			Login
		</h1>
		<ul>
			<li><a href="/">Home</a></li>
		</ul>
		<div>
			<input bind:value={user_email}><br />
			<input type=password bind:value={user_password}>
			<button on:click={loginClick}>
				Login
			</button>
		</div>
	</div>
	<br><br>
</div>
<script>
	import { getContext } from 'svelte';
	import router from 'page';
	import { gotrue, auth_response } from './stores/auth.js';
	let user_email = '';
	let user_password = '';


	function loginClick() {
		console.log(user_email,user_password);
		$gotrue	
			.login(user_email, user_password)
			.then(response => {
				alert("Success! Response: " + JSON.stringify({ response }));
				console.log(JSON.stringify({ response }))
				auth_response.set(response);
    			router.redirect('/');
			})
			.catch(error => alert("Failed :( " + JSON.stringify(error)));
	}
</script>

<!--
{"response":
	{"api":
		{
			"apiURL":"http://127.0.0.1:9999",
			"_sameOrigin":true,"defaultHeaders":{}
		},
		"url":"http://127.0.0.1:9999",
		"token":{
			"access_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhcGkubmV0bGlmeS5jb20iLCJleHAiOjE1NTYxMTY4MDMsInN1YiI6Ijk3YzAwNzMxLWRjNTUtNDgyMC1hZWZiLTI2NjMyOGExZDVkZiIsImVtYWlsIjoiYmtldGVsc2VuQGdtYWlsLmNvbSIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIn0sInVzZXJfbWV0YWRhdGEiOnt9fQ.4F6K7FsoT9Z7br7uDagoXp1WyZCGff5W7FRlfcKpihc",
			"token_type":"bearer",
			"expires_in":3600,
			"refresh_token":"GGN70Vl29k2605a7lVhASw",
			"expires_at":1556116803000
		},
		"id":"97c00731-dc55-4820-aefb-266328a1d5df",
		"aud":"api.netlify.com",
		"role":"",
		"email":"bketelsen@gmail.com",
		"confirmed_at":"2019-04-22T15:42:55Z",
		"confirmation_sent_at":"2019-04-22T15:41:44Z",
		"recovery_sent_at":"2019-04-24T13:17:53Z",
		"app_metadata":{"provider":"email"},
		"user_metadata":{},
		"created_at":"2019-04-22T15:41:44Z",
		"updated_at":"2019-04-22T15:41:44Z"
	}
}
-->